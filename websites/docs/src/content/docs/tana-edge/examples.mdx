---
title: Edge Examples
description: Complete examples for building contracts with tana-edge
sidebar:
  order: 2
---

Real-world examples of building HTTP APIs with tana-edge.

## Hello World

The simplest possible edge contract:

```typescript title="contracts/hello/get.ts"
import { Request, Response } from 'tana/net'

export function Get(req: Request) {
  return Response.json({
    message: 'Hello from tana-edge!',
    timestamp: Date.now()
  })
}
```

**Test it:**
```bash
curl http://localhost:8082/hello
```

## POST with JSON Body

Handle POST requests with JSON data:

```typescript title="contracts/echo/post.ts"
import { Request, Response } from 'tana/net'
import { console } from 'tana/core'

export function Post(req: Request, body: any) {
  console.log('Received:', body)

  return Response.json({
    echo: body,
    received: Date.now()
  })
}
```

**Test it:**
```bash
curl -X POST http://localhost:8082/echo \
  -H "Content-Type: application/json" \
  -d '{"name":"test","value":42}'
```

## Blockchain Queries

Query blockchain state from your contract:

```typescript title="contracts/account/get.ts"
import { Request, Response } from 'tana/net'
import { block } from 'tana/block'

export async function Get(req: Request) {
  // Get user balance from blockchain
  const balance = await block.getBalance('alice', 'USD')

  // Get blockchain context
  const height = block.getHeight()
  const timestamp = block.getTimestamp()

  return Response.json({
    user: 'alice',
    balance,
    blockHeight: Number(height),
    timestamp
  })
}
```

**Response:**
```json
{
  "status": 200,
  "body": {
    "user": "alice",
    "balance": 1000,
    "blockHeight": 12345,
    "timestamp": 1762631458341
  }
}
```

## Persistent Storage

Store data across requests with `tana/data`:

```typescript title="contracts/counter/get.ts"
import { Request, Response } from 'tana/net'
import { data } from 'tana/data'

export async function Get(req: Request) {
  // Get current count
  const count = await data.get('count') || 0

  // Increment
  await data.set('count', count + 1)
  await data.commit()

  return Response.json({
    count: count + 1,
    message: 'Counter incremented!'
  })
}
```

Every request increments the counter, and the value persists!

## Transaction Staging

Stage blockchain transactions from edge:

```typescript title="contracts/transfer/post.ts"
import { Request, Response } from 'tana/net'
import { tx } from 'tana/tx'
import { console } from 'tana/core'

export function Post(req: Request, body: any) {
  const { from, to, amount, currency } = body

  // Stage a transfer transaction
  tx.transfer(from, to, amount, currency)

  // Get staged changes
  const changes = tx.getChanges()

  console.log('Staged changes:', changes)

  return Response.json({
    message: 'Transfer staged',
    changes,
    note: 'Call tx.execute() to commit to blockchain'
  })
}
```

**Test it:**
```bash
curl -X POST http://localhost:8082/transfer \
  -H "Content-Type: application/json" \
  -d '{"from":"alice","to":"bob","amount":100,"currency":"USD"}'
```

## External API Calls

Fetch data from external services:

```typescript title="contracts/pokemon/get.ts"
import { Request, Response } from 'tana/net'
import { fetch } from 'tana/utils'

export async function Get(req: Request) {
  // Fetch from external API (whitelisted domain)
  const response = await fetch('https://pokeapi.co/api/v2/pokemon/pikachu')
  const pokemon = await response.json()

  return Response.json({
    name: pokemon.name,
    height: pokemon.height,
    weight: pokemon.weight,
    abilities: pokemon.abilities.map(a => a.ability.name)
  })
}
```

**Note:** Only whitelisted domains are allowed (pokeapi.co, tana.dev, localhost)

## Custom Status Codes

Return appropriate HTTP status codes:

```typescript title="contracts/users/get.ts"
import { Request, Response } from 'tana/net'
import { block } from 'tana/block'

export async function Get(req: Request) {
  const userId = req.query.id

  if (!userId) {
    return Response.json(
      { error: 'Missing user ID' },
      400  // Bad Request
    )
  }

  const user = await block.getUser(userId)

  if (!user) {
    return Response.json(
      { error: 'User not found' },
      404  // Not Found
    )
  }

  return Response.json({ user })  // 200 OK
}
```

## Complete Example: API with All Features

A full-featured contract using all available modules:

```typescript title="contracts/api/get.ts"
import { Request, Response } from 'tana/net'
import { console } from 'tana/core'
import { block } from 'tana/block'
import { data } from 'tana/data'
import { tx } from 'tana/tx'

export async function Get(req: Request) {
  console.log('API request received')

  try {
    // 1. Track analytics
    const visits = await data.get('visits') || 0
    await data.set('visits', visits + 1)
    await data.set('lastVisit', Date.now())
    await data.commit()

    // 2. Get blockchain context
    const height = Number(block.getHeight())
    const gasLimit = Number(block.getGasLimit())
    const timestamp = block.getTimestamp()

    // 3. Query user balance
    const balance = await block.getBalance('alice', 'USD')

    // 4. Stage a transaction (for demo)
    tx.transfer('alice', 'bob', 10, 'USD')
    const stagedTx = tx.getChanges()

    // 5. Return comprehensive response
    return Response.json({
      api: {
        version: '1.0.0',
        totalVisits: visits + 1,
        lastVisit: Date.now()
      },
      blockchain: {
        height,
        timestamp,
        gasLimit
      },
      user: {
        id: 'alice',
        balance
      },
      transactions: {
        staged: stagedTx.length,
        preview: stagedTx
      }
    })
  } catch (error) {
    console.error('Error:', error)
    return Response.json(
      { error: error.message },
      500
    )
  }
}
```

**Response:**
```json
{
  "status": 200,
  "body": {
    "api": {
      "version": "1.0.0",
      "totalVisits": 5,
      "lastVisit": 1762631458341
    },
    "blockchain": {
      "height": 12345,
      "timestamp": 1762631458341,
      "gasLimit": 1000000
    },
    "user": {
      "id": "alice",
      "balance": 1000
    },
    "transactions": {
      "staged": 1,
      "preview": [
        {
          "type": "transfer",
          "from": "alice",
          "to": "bob",
          "amount": 10,
          "currency": "USD"
        }
      ]
    }
  }
}
```

## Module Reference

Quick reference for all available modules:

```typescript
// tana/core - Logging and version info
import { console } from 'tana/core'
console.log('message')
console.error('error')

// tana/net - HTTP primitives
import { Request, Response } from 'tana/net'
Response.json(data, 200)
Response.text('hello', 200)

// tana/block - Blockchain queries
import { block } from 'tana/block'
await block.getBalance(userId, currency)
await block.getUser(userId)
await block.getTransaction(txId)
block.getHeight()
block.getTimestamp()
block.getHash()

// tana/data - Key-value storage
import { data } from 'tana/data'
await data.set(key, value)
await data.get(key)
await data.has(key)
await data.delete(key)
await data.keys(pattern)
await data.commit()

// tana/tx - Transaction staging
import { tx } from 'tana/tx'
tx.transfer(from, to, amount, currency)
tx.setBalance(userId, amount, currency)
tx.getChanges()
tx.execute()

// tana/utils - External HTTP
import { fetch } from 'tana/utils'
const response = await fetch(url)
const data = await response.json()
```

## Next Steps

- **[API Reference](/tana-api/modules/)** - Detailed module documentation
- **[Architecture](/guides/architecture/)** - Understanding the hybrid model
- **[CLI Guide](/tana-cli/intro/)** - Deploy contracts to blockchain
